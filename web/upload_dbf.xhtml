<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./resources/template/template_1.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:pou="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="content">

        <h:form enctype="multipart/form-data">
            <pou:growl ></pou:growl>
            <pou:panel header="Instruction to submit" >
                This page allows you to upload the data in the payroll system to the web application. <br/>
                <br/>
                First you have to select your institution. If you institution is not listed, please contact the administrators to add it for you.
                <br/>
                You need to locate the Folder where the payroll application is installed. Usually it is located in the c:gpswt12 folder. Please locate PYREMPMA.DBF file and upload it. It containts all the details of the employees.
                <br/>
                After you select the file and click the upload button, you will see a list of the details you are going to save to the system.  You will also see the list of the data already stored in the system. If you click the save button, the system will replace the existing data with the new data you upload.
                <br/>
                <br/>
            </pou:panel>
            <pou:panel header="Uploading Payment Cycle Details" >
                <pou:panelGrid columns="6" >
                    <h:outputText value="Institution"/>
                    <h:outputText value="Set"/>
                    <h:outputText value="Year"/>
                    <h:outputText value="Month"/>
                    <h:outputText value="&nbsp;"/>
                    <h:outputText value="&nbsp;"/>

                    <pou:panel id="cmbLoc" style="border: 0px;margin: 0px;padding: 0px;">
                        <h:selectOneListbox rendered="#{sessionController.privilege.restrictedInstitution == null}"  id="cmbLoc1" value="#{dbfController.institution}" size="1" >
                            <f:selectItems value="#{institutionController.offItems}" var="ins" itemValue="#{ins}" itemLabel="#{ins.name}" />
                            <f:ajax event="change" execute="cmbLoc cmbSet cmbYear cmbMonth" render="cmbSet tabTbls gridSummery" />
                        </h:selectOneListbox>
                        <h:outputLabel rendered="#{sessionController.privilege.restrictedInstitution != null}"  value="#{sessionController.privilege.restrictedInstitution.name}"/>
                    </pou:panel>


                    <h:selectOneListbox id="cmbYear" value="#{dbfController.payYear}" size="1">
                        <f:selectItems value="#{dbfController.payYears}" var="py" itemValue="#{py}" itemLabel="#{py}" />
                        <f:ajax event="change" execute="cmbLoc cmbSet cmbYear cmbMonth" render="cmbSet tabTbls gridSummery" />
                    </h:selectOneListbox>

                    <h:selectOneListbox id="cmbMonth" value="#{dbfController.payMonth}" size="1" >
                        <f:selectItem itemValue="1" itemLabel="January" />
                        <f:selectItem itemValue="2" itemLabel="February" />
                        <f:selectItem itemValue="3" itemLabel="March" />
                        <f:selectItem itemValue="4" itemLabel="April" />
                        <f:selectItem itemValue="5" itemLabel="May" />
                        <f:selectItem itemValue="6" itemLabel="June" />
                        <f:selectItem itemValue="7" itemLabel="July" />
                        <f:selectItem itemValue="8" itemLabel="August" />
                        <f:selectItem itemValue="9" itemLabel="September" />
                        <f:selectItem itemValue="10" itemLabel="October" />
                        <f:selectItem itemValue="11" itemLabel="November" />
                        <f:selectItem itemValue="12" itemLabel="December" />
                        <f:ajax event="change" execute="cmbLoc cmbSet cmbYear cmbMonth" render="cmbSet tabTbls gridSummery" />
                    </h:selectOneListbox>


                    <h:selectOneListbox id="cmbSet" value="#{dbfController.insSet}" size="1">
                        <f:selectItems value="#{dbfController.insSets}" var="insset" itemValue="#{insset}" itemLabel="#{insset.name}" />
                        <f:ajax event="change" execute="cmbLoc cmbSet cmbYear cmbMonth" render="cmbSet tabTbls gridSummery" />
                    </h:selectOneListbox>


                    <pou:fileUpload value="#{dbfController.file}" mode="simple"/>
                    <h:commandButton value="Upload" action="#{dbfController.extractData}"/>


                </pou:panelGrid>
            </pou:panel>

            <pou:panel id="gridSummery" header="Summery" >
                <pou:panelGrid columns="2" >
                    <h:outputLabel value="Records without NIC"/>
                    <h:outputLabel   value="#{dbfController.withoutNicCount}" />
                    
                   <h:outputLabel value="Records without Designations"/>
                   <h:outputLabel   value="#{dbfController.withoutDesignationCount}" />
                   
                   <h:outputLabel value="Records without Identifiable Designations"/>
                   <h:outputLabel   value="#{dbfController.withoutMappedDesignationCount}" />
                    
                   <h:outputLabel value="Records without Institutions"/>
                   <h:outputLabel   value="#{dbfController.withoutInstitutionCount}" />
                    
                   <h:outputLabel value="Records without Identifiable Institutions"/>
                   <h:outputLabel   value="#{dbfController.withoutMappedInstitutionCount}" />
                   
                   <h:outputLabel value="Active Records"/>
                   <h:outputLabel   value="#{dbfController.activeCount}" />
                    
                   <h:outputLabel value="Temporary Person Records"/>
                   <h:outputLabel   value="#{dbfController.temporaryCount}" />
                   
                </pou:panelGrid>

            </pou:panel>


            <pou:panel rendered="#{dbfController.newPersonInstitutions.size()>0}" header="Replace Existing Data With new Data">
                <h:commandButton value="Replace" action="#{dbfController.replaceData}"/>
            </pou:panel>

            <pou:tabView id="tabTbls"  dynamic="true" activeIndex="#{dbfController.activeTab}">

                <pou:tab title="Existing Data">
                    <pou:panel header="Existing Data">
                        <pou:dataTable id="tblEx" value="#{dbfController.existingPersonInstitutions}" var="exPi">
                            <pou:column>
                                <f:facet name="header">Employee Id</f:facet>
                                <h:outputLabel value="#{exPi.empNo}"/>
                            </pou:column>
                            <pou:column>
                                <f:facet name="header">Name</f:facet>
                                <h:outputLabel value="#{exPi.name}"/>
                            </pou:column> 
                            <pou:column>
                                <f:facet name="header">Designation</f:facet>
                                <h:outputLabel value="#{exPi.designation.name}"/>
                            </pou:column>  
                            <pou:column>
                                <f:facet name="header">NIC</f:facet>
                                <h:outputLabel value="#{exPi.nic}"/>
                            </pou:column>           

                        </pou:dataTable>
                    </pou:panel>

                </pou:tab>




            </pou:tabView>



        </h:form>
    </ui:define>
</ui:composition>
